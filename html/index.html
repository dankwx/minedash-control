<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHASSAHROPOLIS</title>
    <link rel="preconnect" href="https://fonts.bunny.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.bunny.net/css?family=geist-mono:400,500,600,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- User Profile Button (Top Center) -->
    <div class="user-profile-container">
        <div class="user-profile" id="userProfile" style="display: none;">
            <img src="" alt="Avatar" class="user-avatar" id="userAvatar">
            <span class="user-name" id="userName">...</span>
            <div class="user-dropdown-icon"></div>
            <div class="user-dropdown" id="userDropdown">
                <a href="/perfil" class="user-dropdown-item">Perfil</a>
                <div class="user-dropdown-item" id="logoutBtn">Logout</div>
            </div>
        </div>
        <a href="mine.html" class="login-link" id="loginLink">[ LOGIN ]</a>
    </div>

    <main class="main-content">
        <h1>MHASSAHRO
POLIS</h1>

        <div class="pcs-container" id="pcs-container">
            <!-- PCs will be inserted here by JS -->
        </div>

        <div class="image-container">
            <img src="../usar.jpg" alt="Low poly girl">
        </div>

        <nav>
            <a href="mine.html">mine</a>
            <a href="/about">about</a>
        </nav>
    </main>

    <div class="footer" id="footerToggle"><span></span></div>

    <!-- Bottom Panel Overlay -->
    <div class="bottom-panel-overlay" id="bottomPanelOverlay"></div>
    <aside class="bottom-panel" id="bottomPanel">
        <div class="bottom-panel-header">
            <div class="bottom-panel-handle"></div>
        </div>
        <div class="bottom-panel-content">
            <div class="diagram-container">
                <!-- Title -->
                <div class="diagram-title">INTRANET PRIVADA MHASSAHROPOLIS</div>
                
                <!-- External Network Bar -->
                <div class="external-bar">
                    <span class="external-label">INTERNET</span>
                </div>
                
                <!-- Connection Line from Internet to VM -->
                <div class="diagram-line-single"></div>
                
                <!-- Top Row - Oracle VM -->
                <div class="diagram-top-row-single">
                    <div class="diagram-box good">
                        <div class="box-header">
                            <span class="box-status good">●</span>
                            <span class="box-title">ORACLE VM</span>
                        </div>
                        <div class="box-specs">
                            <div>4 OCPU Ampere</div>
                            <div>24GB RAM</div>
                            <div>200GB SSD</div>
                        </div>
                    </div>
                </div>
                
                <!-- Connection Line Top -->
                <div class="diagram-line-single"></div>
                
                <!-- Zerotier Network Bar -->
                <div class="zerotier-bar">
                    <span class="zerotier-label">ZEROTIER NETWORK</span>
                </div>
                
                <!-- Connection Lines Bottom -->
                <div class="diagram-lines-bottom">
                    <div class="line-b1"></div>
                    <div class="line-b2"></div>
                    <div class="line-b3"></div>
                    <div class="line-b4"></div>
                </div>
                
                <!-- Bottom Row - PCs -->
                <div class="diagram-bottom-row">
                    <div class="diagram-box-small">
                        <div class="box-header">
                            <span class="box-status good">●</span>
                            <span class="box-title">ALYSSON</span>
                        </div>
                    </div>
                    <div class="diagram-box-small">
                        <div class="box-header">
                            <span class="box-status good">●</span>
                            <span class="box-title">ALLAN</span>
                        </div>
                    </div>
                    <div class="diagram-box-small">
                        <div class="box-header">
                            <span class="box-status bad">●</span>
                            <span class="box-title">DANIEL</span>
                        </div>
                    </div>
                    <div class="diagram-box-small">
                        <div class="box-header">
                            <span class="box-status good">●</span>
                            <span class="box-title">LUCAS</span>
                        </div>
                    </div>
                </div>

                <!-- Cult Description -->
                <div class="intranet-manifesto">
                    <div class="manifesto-divider">◇ ◇ ◇</div>
                    <p class="manifesto-text">
                        Bem-vindo à <span class="highlight">MHASSAHROPOLIS</span> — uma intranet privada que existe fora dos algoritmos, longe dos crawlers e invisível para o normie médio. 
                        Isso aqui não é a surface web. É um ecossistema digital <span class="highlight">air-gapped</span> da matrix corporativa, rodando em infra própria, 
                        com zero telemetria e máxima autonomia.
                    </p>
                    <p class="manifesto-text">
                        Nossa rede opera via <span class="highlight">ZeroTier mesh network</span> — um overlay P2P criptografado end-to-end que faz nossos pacotes 
                        atravessarem a internet pública como fantasmas. Cada node é um peer trusted, cada conexão é um handshake entre os based.
                    </p>
                    <p class="manifesto-text small">
                        TL;DR: enquanto vocês ainda estão no clearnet sendo datamined, nós estamos no nosso próprio namespace, 
                        self-hosted, decentralized-ish, e genuinamente <span class="highlight">comfy</span>. 
                        Isso aqui é digital sovereignty pra quem entende. IYKYK.
                    </p>
                    <div class="manifesto-footer">
                        <span class="footer-tag">#PRIVACYMAXXING</span>
                        <span class="footer-tag">#BASEDINFRA</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <script>
        const pcs = [
            { name: "alysson", ip: "10.150.135.200", online: true },
            { name: "allan", ip: "10.150.135.138", online: true },
            { name: "daniel", ip: "10.150.135.128", online: false },
            { name: "lucas", ip: "10.150.135.113", online: true },
        ];

        const container = document.getElementById('pcs-container');

        pcs.forEach(pc => {
            const pcDiv = document.createElement('div');
            pcDiv.className = 'pc';

            const statusDiv = document.createElement('div');
            statusDiv.className = 'pc-status';

            const dot = document.createElement('span');
            dot.className = `status-dot ${pc.online ? 'online' : 'offline'}`;

            const nameSpan = document.createElement('span');
            nameSpan.className = 'pc-name';
            nameSpan.textContent = pc.name;

            statusDiv.appendChild(dot);
            statusDiv.appendChild(nameSpan);

            const ipSpan = document.createElement('span');
            ipSpan.className = 'pc-ip';
            ipSpan.textContent = pc.ip;

            pcDiv.appendChild(statusDiv);
            pcDiv.appendChild(ipSpan);

            container.appendChild(pcDiv);
        });

        // === User Profile (reusing server.py auth) ===
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userDropdown = document.getElementById('userDropdown');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginLink = document.getElementById('loginLink');

        async function loadUserProfile() {
            try {
                const response = await fetch('/api/user-info');
                const data = await response.json();
                
                if (data.authenticated && data.userName) {
                    userAvatar.src = data.avatar || '';
                    userName.textContent = data.userName;
                    userProfile.style.display = 'flex';
                    loginLink.style.display = 'none';
                } else {
                    userProfile.style.display = 'none';
                    loginLink.style.display = 'block';
                }
            } catch (error) {
                console.error('Erro ao carregar perfil:', error);
                userProfile.style.display = 'none';
                loginLink.style.display = 'block';
            }
        }

        // Toggle dropdown
        userProfile.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('active');
        });

        // Logout
        logoutBtn.addEventListener('click', async (e) => {
            e.stopPropagation();
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.reload();
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        });

        // Close dropdown on outside click
        document.addEventListener('click', () => {
            userDropdown.classList.remove('active');
        });

        // Load profile on page load
        loadUserProfile();

        // Bottom Panel Toggle
        const footerToggle = document.getElementById('footerToggle');
        const bottomPanel = document.getElementById('bottomPanel');
        const bottomPanelOverlay = document.getElementById('bottomPanelOverlay');

        footerToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            bottomPanel.classList.toggle('open');
            bottomPanelOverlay.classList.toggle('open');
        });

        // Fechar ao clicar no overlay
        bottomPanelOverlay.addEventListener('click', () => {
            bottomPanel.classList.remove('open');
            bottomPanelOverlay.classList.remove('open');
        });

        // Fechar ao clicar no handle do header
        document.querySelector('.bottom-panel-header').addEventListener('click', () => {
            bottomPanel.classList.remove('open');
            bottomPanelOverlay.classList.remove('open');
        });
    </script>
</body>
</html>
